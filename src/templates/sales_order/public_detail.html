{% extends "layout/base.html" %}
{% load humanize %}
{% load static %}
{% block content %}
<form method="post" id="confirmForm" action="{% url 'sales_order:update' pk=order.pk %}">
  {% csrf_token %}
  <div class="container mt-4">
    <h2 class="mb-3">受注データ承認確認画面</h2>

    <div class="card mb-4">
      <div class="card-body">
        <p><strong>受注番号:</strong> {{ order.sales_order_no }}</p>
        <p><strong>取引先:</strong> {{ order.partner.partner_name }}</p>
        <p><strong>受注日:</strong> {{ order.sales_order_date|date:"Y-m-d" }}</p>
        <p><strong>備考:</strong> {{ order.remarks|default:"-" }}</p>
      </div>
    </div>

    <h5>受注明細</h5>
    <table class="table table-bordered table-sm">
      <thead class="table-light">
        <tr>
          <th>行No</th>
          <th>商品</th>
          <th>数量</th>
          <th>単価</th>
          <th>金額</th>
        </tr>
      </thead>
      <tbody>
        {% for d in details %}
        <tr>
          <td>{{ d.line_no }}</td>
          <td>{{ d.product }}</td>
          <td>{{ d.quantity|floatformat:0|intcomma }}{{ d.product.unit }}</td>
          <td>{{ d.billing_unit_price|floatformat:0|intcomma }} 円</td>
          <td>{{ d.amount_d|floatformat:0|intcomma }} 円</td>
        </tr>
        {% empty %}
        <tr><td colspan="5" class="text-center text-muted">明細がありません</td></tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="card text-end p-3 bg-light border-0">
      <p><strong>小計：</strong> {{ subtotal|floatformat:0|intcomma }} 円</p>
      <p><strong>消費税：</strong> {{ tax_total|floatformat:0|intcomma }} 円</p>
      <h5 class="mt-3"><strong>合計金額：</strong> {{ total|floatformat:0|intcomma }} 円</h5>
    </div>
    {# フッタボタン #}
    <div class="d-flex justify-content-end gap-2 mt-3">
      <button type="submit" class="btn btn-primary" data-action="CONFIRMED">承諾</button>
      <button type="submit" class="btn btn-danger" data-action="REJECTED_OUT">拒否</button>
      <input type="hidden" name="action_type" id="action_type">
    </div>
    <p class="text-muted small mt-3">
      ※このページは受注情報確認専用です。
    </p>
  </div>
</form>
<script type="text/javascript" src="{% static 'js/sales_order/script.js' %}"></script>
{% endblock %}
