{% extends 'layout/base.html' %}
{% load static %}
{% block content %}
  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3">
    <h1 class="h2">受注削除確認</h1>
  </div>

  <div class="container-fluid">
    <div class="card shadow-sm edit-area" style="max-width: 900px;">
      <div class="card-body">
        <p class="mb-4 text-danger fw-bold">
          以下の受注を削除してもよろしいですか？<br>
          （※ 論理削除され、一覧からは表示されなくなります）
        </p>

        <table class="table table-bordered align-middle">
          <tbody>
            <tr>
              <th class="table-light col-3">受注番号</th>
              <td>{{ object.order_no }}</td>
            </tr>
            <tr>
              <th class="table-light">受注日</th>
              <td>{{ object.order_date }}</td>
            </tr>
            <tr>
              <th class="table-light">取引先</th>
              <td>{{ object.partner.partner_name }}</td>
            </tr>
            <tr>
              <th class="table-light">備考</th>
              <td>{{ object.remarks|default_if_none:'' }}</td>
            </tr>
            <tr>
              <th class="table-light">登録日時</th>
              <td>{{ object.created_at }}</td>
            </tr>
            <tr>
              <th class="table-light">更新日時</th>
              <td>{{ object.updated_at }}</td>
            </tr>
          </tbody>
        </table>

        {# 明細があれば一覧表示 #}
        {% if object.details.all %}
        <h5 class="mt-4">受注明細</h5>
        <table class="table table-sm table-bordered">
          <thead class="table-light">
            <tr>
              <th>商品</th>
              <th>数量</th>
              <th>単位</th>
              <th>単価</th>
              <th>金額</th>
              <th>消費税率</th>
              <th>税対象外</th>
              <th>丸め方法</th>
            </tr>
          </thead>
          <tbody>
            {% for detail in object.details.all %}
            <tr>
              <td>{{ detail.product.product_nm }}</td>
              <td>{{ detail.quantity }}</td>
              <td>{{ detail.unit }}</td>
              <td>{{ detail.unit_price }}</td>
              <td>{{ detail.amount }}</td>
              <td>{{ detail.tax_rate }}%</td>
              <td>{% if detail.is_tax_exempt %}対象外{% else %}対象{% endif %}</td>
              <td>{{ detail.get_rounding_method_display }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% endif %}

        <form method="post">
          {% csrf_token %}
          <div class="d-flex justify-content-between mt-4">
            <div>
              <a href="{% url 'sales_order:salesorder_list' %}" class="btn btn-outline-secondary me-2">一覧へ戻る</a>
              <a href="javascript:history.back()" class="btn btn-outline-secondary">前のページに戻る</a>
            </div>
            <button type="submit" class="btn btn-danger px-4"
                    onclick="return confirm('本当に削除しますか？');">
              削除する
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
{% endblock %}
