{% load static %}
{% load django_bootstrap5 %}
<!doctype html>
<html lang="ja" data-bs-theme="auto">
<head>
  {% bootstrap_css %}
  {% bootstrap_javascript %}
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}Django APP{% endblock %}</title>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
          integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
          crossorigin="anonymous"></script>
  <script type="text/javascript" src="{% static 'js/common/script.js' %}"></script>
  {% block extra_css %}
  <style>
    .invalid-feedback {
      display: block; /* 常に表示されるように */
    }
  </style>
  {% endblock %}
</head>
<body class="d-flex align-items-center justify-content-center min-vh-100 bg-light">
  <div class="bg-white rounded-3 border p-3" style="max-width: 480px;">
    <form action="" method="POST" novalidate>
      {% csrf_token %}
      <h2>パスワードリセット</h2>
      <hr>
      <p>メールアドレスを入力して送信ボタンを押してください。</p>

      {# フィールドごとにエラー処理を追加 #}
      {% for field in form %}
        <div class="form-group mb-3">
          <input
            type="{{ field.field.widget.input_type }}"
            name="{{ field.name }}"
            id="{{ field.id_for_label }}"
            value="{{ field.value|default:'' }}"
            class="form-control {% if field.errors %}is-invalid{% endif %}"
            autocomplete="email"
            maxlength="254"
            required
            placeholder="{{ field.label }}"
          >
          {% if field.errors %}
            {% for error in field.errors %}
              <div class="invalid-feedback">{{ error }}</div>
            {% endfor %}
          {% endif %}
        </div>
      {% endfor %}

      {# フォーム全体のエラー（non_field_errors）#}
      {% if form.non_field_errors %}
        <div class="alert alert-danger">
          {% for error in form.non_field_errors %}
            <div>{{ error }}</div>
          {% endfor %}
        </div>
      {% endif %}

      <div class="text-muted small mb-2">
        メールアドレスはあらかじめシステムに登録が必要です。<br>
        メールが届かない場合はシステム管理者に連絡してください。
      </div>

      <hr>
      <div class="form-group text-end">
        <a class="btn btn-secondary" href="/login/">キャンセル</a>
        <button type="submit" class="btn btn-primary">送信</button>
      </div>
    </form>
  </div>
</body>
</html>
